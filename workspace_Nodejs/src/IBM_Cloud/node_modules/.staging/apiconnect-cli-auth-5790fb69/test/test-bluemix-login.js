/********************************************************* {COPYRIGHT-TOP} ***
 * Licensed Materials - Property of IBM
 * 5725-Z22, 5725-Z63, 5725-U33, 5725-Z63
 *
 * (C) Copyright IBM Corporation 2016, 2017
 *
 * All Rights Reserved.
 * US Government Users Restricted Rights - Use, duplication or disclosure
 * restricted by GSA ADP Schedule Contract with IBM Corp.
 ********************************************************** {COPYRIGHT-END} **/
// Node module: apiconnect-cli-auth

var f = require('util').format;
var path = require('path');
var test = require('tap').test;
var testSupport = require('apiconnect-cli-test-support');

var apic = testSupport.apic(path.resolve(__dirname, '..'));

var bluemix; // = 'us.apiconnect.ibmcloud.com'
var user; // = 'x@us.ibm.com';
var password; // = 'x';

var skip = bluemix === undefined;

test('test bluemix non-interactive missing passcode', { skip: skip }, function(t) {
  var bluemix = 'us.apiconnect.ibmcloud.com';
  return apic([ 'login', '--server', bluemix, '-u', user, '-p', password ])
    .then(t.fail)
    .catch(function(err) {
      var reg = /Login to (.)* failed. The --passcode option\(s\) are required. Generate a passcode from http(.)*/;
      t.ok(err);
      t.ok(err.message.match(reg), f('Found', err.message));
    });
});

