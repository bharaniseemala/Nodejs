'use strict';

var _ = require('lodash');
var fs = require('fs');
var jsyaml = require('js-yaml');
var path = require('path');
var test = require('tap').test;
var validate = require('../index');

var api = jsyaml.safeLoad(fs.readFileSync(path.join(__dirname, 'fixtures/vendor-extensions/api.yaml')));
var ee = jsyaml.safeLoad(fs.readFileSync(path.join(__dirname, 'fixtures/vendor-extensions/ee.yaml')));

var extension = {
    name: 'EndpointExtension',
    title: 'endpoint-extension',
    schema: ee
};

test('test validate vendor extension', function(t) {
    return validate.validateAPI(api, [ extension ]).then(function(res) {
        t.ok(res);
        var eeRes = _.find(res, { title: 'endpoint-extension' });
        t.ok(eeRes);
        t.equals(eeRes.status, 'valid');
    });
});
